<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart | Zero</title>
    <script src="js/config.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* iOS Safari tap fix - make all clickable elements tappable */
        [onclick], button, [role="button"], .clickable {
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0.2);
            -webkit-touch-callout: none;
        }

        body {
            padding-top: 110px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #2d1b4e 30%, #4a1942 60%, #1f1f3a 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .main-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 24px;
        }

        .page-header {
            margin-bottom: 48px;
            text-align: center;
            position: relative;
        }

        .page-title {
            font-size: 56px;
            font-weight: 900;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }

        .page-subtitle {
            font-size: 20px;
            color: rgba(255, 255, 255, 0.8);
            max-width: 800px;
            margin: 0 auto;
        }

        .header-nav {
            position: absolute;
            top: 0;
            right: 0;
        }

        .btn-home {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-home:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        .section {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 32px;
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-content {
            font-size: 16px;
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.9);
        }

        .section-content p {
            margin-bottom: 16px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 28px;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-4px);
            border-color: rgba(102, 126, 234, 0.4);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.2);
        }

        .feature-icon {
            font-size: 42px;
            margin-bottom: 16px;
            display: block;
        }

        .feature-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #fff;
        }

        .feature-description {
            font-size: 15px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.85);
        }

        .steps-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 24px;
        }

        .step-item {
            display: flex;
            gap: 20px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 24px;
            transition: all 0.3s ease;
        }

        .step-item:hover {
            transform: translateX(8px);
            border-color: rgba(102, 126, 234, 0.4);
        }

        .step-number {
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            flex-shrink: 0;
            width: 50px;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #fff;
        }

        .step-description {
            font-size: 15px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.85);
        }

        .endpoints-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 24px;
        }

        .endpoint-item {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 20px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.3s ease;
        }

        .endpoint-item:hover {
            border-color: rgba(102, 126, 234, 0.4);
            transform: translateX(4px);
        }

        .endpoint-method {
            font-size: 13px;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex-shrink: 0;
        }

        .endpoint-method.post {
            background: rgba(52, 199, 89, 0.2);
            color: #34c759;
            border: 1px solid rgba(52, 199, 89, 0.3);
        }

        .endpoint-method.get {
            background: rgba(0, 122, 255, 0.2);
            color: #007aff;
            border: 1px solid rgba(0, 122, 255, 0.3);
        }

        .endpoint-method.delete {
            background: rgba(255, 59, 48, 0.2);
            color: #ff3b30;
            border: 1px solid rgba(255, 59, 48, 0.3);
        }

        .endpoint-method.patch {
            background: rgba(255, 159, 10, 0.2);
            color: #ff9f0a;
            border: 1px solid rgba(255, 159, 10, 0.3);
        }

        .endpoint-path {
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 15px;
            color: rgba(255, 255, 255, 0.95);
            flex: 1;
        }

        .endpoint-description {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.7);
            flex: 1.5;
        }

        @media (max-width: 1024px) {
            .page-title {
                font-size: 44px;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .endpoint-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
        }

        @media (max-width: 768px) {
            body {
                padding-top: 120px;
            }

            .main-container {
                padding: 24px 16px;
            }

            .page-title {
                font-size: 36px;
                flex-direction: column;
                gap: 8px;
            }

            .page-subtitle {
                font-size: 16px;
            }

            .section {
                padding: 24px;
            }

            .section-title {
                font-size: 24px;
            }

            .header-nav {
                position: static;
                margin-bottom: 20px;
            }

            .page-header {
                margin-bottom: 32px;
            }
        }
    
        /* Beta Banner - Fixed Top */
        .beta-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg,
                rgba(26, 26, 46, 0.95) 0%,
                rgba(45, 27, 78, 0.95) 30%,
                rgba(74, 25, 66, 0.95) 60%,
                rgba(31, 31, 58, 0.95) 100%
            );
            backdrop-filter: blur(20px);
            border-bottom: 2px solid rgba(139, 92, 246, 0.4);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.15),
                        0 0 40px rgba(139, 92, 246, 0.1);
            padding: 12px 20px;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            flex-wrap: wrap;
        }

        .beta-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(59, 130, 246, 0.05) 20%,
                rgba(139, 92, 246, 0.05) 50%,
                rgba(59, 130, 246, 0.05) 80%,
                transparent 100%
            );
            pointer-events: none;
            animation: shimmer 8s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .beta-banner-content {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            flex: 1;
            position: relative;
            z-index: 1;
        }

        .beta-banner-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .beta-banner-title {
            font-size: 16px;
            font-weight: 700;
            color: white;
        }

        .beta-banner-subtitle {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
        }

        .beta-banner-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .beta-banner-btn {
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .beta-banner-btn.primary {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #6366f1 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3),
                        0 0 20px rgba(139, 92, 246, 0.2);
            position: relative;
            overflow: hidden;
        }

        .beta-banner-btn.primary::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            transform: rotate(45deg);
            animation: button-shine 3s ease-in-out infinite;
        }

        @keyframes button-shine {
            0%, 100% { transform: translateX(-100%) rotate(45deg); }
            50% { transform: translateX(100%) rotate(45deg); }
        }

        .beta-banner-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(59, 130, 246, 0.5),
                        0 0 40px rgba(139, 92, 246, 0.3);
            background: linear-gradient(135deg, #2563eb 0%, #7c3aed 50%, #4f46e5 100%);
        }

        .beta-banner-btn.secondary {
            background: rgba(139, 92, 246, 0.1);
            color: white;
            border: 1px solid rgba(139, 92, 246, 0.4);
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.1);
        }

        .beta-banner-btn.secondary:hover {
            background: rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.6);
            box-shadow: 0 4px 16px rgba(139, 92, 246, 0.3);
        }

        @media (max-width: 768px) {
            .beta-banner {
                padding: 10px 16px;
            }

            .beta-banner-actions {
                width: 100%;
            }

            .beta-banner-btn {
                flex: 1;
                text-align: center;
            }
        }

        /* Navigation Bar - Below Beta Banner */
        .main-nav {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            background: rgba(26, 26, 46, 0.92);
            backdrop-filter: blur(15px);
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
            z-index: 9998;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
        }

        .nav-links {
            display: flex;
            gap: 8px;
            list-style: none;
            padding: 8px 0;
        }

        .nav-link {
            padding: 10px 20px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .nav-link:hover {
            background: rgba(139, 92, 246, 0.2);
            color: white;
            transform: translateY(-1px);
        }

        .nav-link.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3));
            color: white;
            border: 1px solid rgba(139, 92, 246, 0.4);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 70px;
            right: 20px;
            z-index: 10000;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(139, 92, 246, 0.9));
            border: none;
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            transition: all 0.3s ease;
        }

        .mobile-menu-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.6);
        }

        /* Mobile Drawer */
        .mobile-drawer {
            position: fixed;
            top: 0;
            right: -100%;
            width: 280px;
            height: 100vh;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.98), rgba(45, 27, 78, 0.98));
            backdrop-filter: blur(20px);
            box-shadow: -4px 0 20px rgba(0, 0, 0, 0.5);
            z-index: 10001;
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 80px 20px 20px 20px;
            overflow-y: auto;
        }

        .mobile-drawer.open {
            right: 0;
        }

        .mobile-drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(139, 92, 246, 0.3);
        }

        .mobile-drawer-title {
            font-size: 20px;
            font-weight: 700;
            color: white;
        }

        .mobile-drawer-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mobile-nav-links {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .mobile-nav-link {
            display: block;
            padding: 16px 20px;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-size: 16px;
            font-weight: 600;
            border-radius: 12px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.03);
        }

        .mobile-nav-link:hover {
            background: rgba(139, 92, 246, 0.2);
            transform: translateX(4px);
        }

        .mobile-nav-link.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3));
            border: 1px solid rgba(139, 92, 246, 0.4);
        }

        /* Mobile Backdrop */
        .mobile-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mobile-backdrop.visible {
            display: block;
            opacity: 1;
        }

        @media (max-width: 768px) {
            body {
                padding-top: 120px;
            }

            .main-nav {
                display: none;
            }

            .mobile-menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }

        /* Interactive Demo Styles */
        .demo-section {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.08) 0%, rgba(220, 38, 38, 0.05) 100%);
            border: 2px solid rgba(239, 68, 68, 0.3);
        }

        .demo-controls {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }

        .demo-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .demo-btn-primary {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .demo-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.5);
        }

        .demo-btn-secondary {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .demo-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .demo-btn-checkout {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            width: 100%;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .demo-btn-checkout:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.5);
        }

        .cart-summary-badge {
            margin-left: auto;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: white;
        }

        .cart-count {
            color: #fbbf24;
        }

        .email-preview {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .email-preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .email-preview-title {
            font-size: 16px;
            font-weight: 700;
            color: white;
        }

        .email-preview-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            font-size: 20px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
        }

        .email-preview-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .email-preview-content {
            background: rgba(0, 0, 0, 0.2);
            padding: 16px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 16px;
            white-space: pre-wrap;
        }

        .cart-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
            min-height: 200px;
        }

        .cart-empty {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 12px;
        }

        .cart-empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .cart-empty-text {
            font-size: 20px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 8px;
        }

        .cart-empty-subtext {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.5);
        }

        .cart-item {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            animation: slideIn 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .cart-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            border-color: rgba(239, 68, 68, 0.4);
        }

        .cart-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .cart-item-image {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 12px;
        }

        .cart-item-name {
            font-size: 16px;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
        }

        .cart-item-merchant {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            color: #93c5fd;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .cart-item-price {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 8px;
        }

        .cart-item-current-price {
            font-size: 24px;
            font-weight: 900;
            color: #10b981;
        }

        .cart-item-original-price {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.5);
            text-decoration: line-through;
        }

        .cart-item-savings {
            display: inline-block;
            padding: 4px 8px;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: #6ee7b7;
            margin-bottom: 12px;
        }

        .cart-item-expiry {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid rgba(245, 158, 11, 0.4);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: #fbbf24;
            margin-bottom: 12px;
        }

        .cart-item-expiry.urgent {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.4);
            color: #fca5a5;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        .cart-item-controls {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 4px;
        }

        .quantity-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .quantity-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .quantity-value {
            min-width: 30px;
            text-align: center;
            font-weight: 600;
            color: white;
        }

        .remove-btn {
            margin-left: auto;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            color: #fca5a5;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .remove-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            border-color: rgba(239, 68, 68, 0.6);
        }

        .checkout-panel {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            grid-column: 1 / -1;
            animation: slideIn 0.4s ease;
        }

        .checkout-summary {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .checkout-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            font-size: 15px;
            color: rgba(255, 255, 255, 0.9);
        }

        .checkout-row.savings {
            color: #10b981;
            font-weight: 600;
        }

        .checkout-row.total {
            border-top: 2px solid rgba(255, 255, 255, 0.2);
            padding-top: 16px;
            margin-top: 12px;
            font-size: 24px;
            font-weight: 700;
            color: white;
        }

        .merchant-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
        }

        .merchant-links-title {
            grid-column: 1 / -1;
            font-size: 13px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 4px;
        }

        .merchant-link {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 18px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(5, 150, 105, 0.1) 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .merchant-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .merchant-link:hover::before {
            left: 100%;
        }

        .merchant-link:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.25) 0%, rgba(5, 150, 105, 0.15) 100%);
            border-color: rgba(16, 185, 129, 0.5);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.2);
        }

        .merchant-link-label {
            font-size: 14px;
            font-weight: 600;
            color: #6ee7b7;
        }

        .merchant-link-price {
            font-size: 18px;
            font-weight: 700;
            color: white;
        }

        /* Hide emojis on mobile */
        @media (max-width: 768px) {
            .demo-btn span:first-child {
                font-size: 0;
            }

            .demo-btn span:first-child::after {
                font-size: 15px;
                content: attr(data-text);
            }

            .cart-item-image {
                display: none;
            }

            .cart-item-savings::before {
                content: '';
            }

            .cart-item-expiry::before {
                content: '';
            }

            .email-preview-title::before {
                content: '';
            }
        }

        @media (max-width: 768px) {
            .cart-container {
                grid-template-columns: 1fr;
            }

            .demo-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .cart-summary-badge {
                margin-left: 0;
                text-align: center;
            }
        }

        /* Side-by-side layout for demo and guide */
        .demo-and-guide-container {
            display: grid;
            grid-template-columns: 55% 43%;
            gap: 24px;
            margin-bottom: 32px;
        }

        /* On mobile, stack vertically */
        @media (max-width: 1024px) {
            .demo-and-guide-container {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .button-loading {
            opacity: 0.7;
            cursor: not-allowed !important;
            pointer-events: none;
        }

    </style>
</head>
<body>
    <!-- Beta Banner -->
    <div class="beta-banner">
        <div class="beta-banner-content">
            <div class="beta-banner-text">
                <div class="beta-banner-title">Ready to Experience ZerO Inbox?</div>
                <div class="beta-banner-subtitle">Join hundreds of beta testers achieving inbox zero every day</div>
            </div>
            <div class="beta-banner-actions">
                <a href="mailto:zerobeta@rationale.work?subject=Zero%20Beta%20Access%20Request" class="beta-banner-btn primary">
                    Request Beta Access
                </a>
                <a href="https://apps.apple.com/us/app/testflight/id899247664" target="_blank" class="beta-banner-btn secondary">
                    Download TestFlight
                </a>
            </div>
        </div>
    </div>

    <!-- Main Navigation (Desktop) -->
    <nav class="main-nav">
        <div class="nav-container">
            <ul class="nav-links">
                <li><a href="landing.html" class="nav-link">Home</a></li>
                <li><a href="app-demo.html" class="nav-link">Live Demo</a></li>
                <li><a href="zero-sequence-live.html" class="nav-link">AI Intelligence</a></li>
                <li><a href="action-modal-explorer.html" class="nav-link">Actions</a></li>
                <li><a href="intent-action-explorer.html" class="nav-link">Intents</a></li>
                <li><a href="shopping-cart.html" class="nav-link active">Shopping</a></li>
                <li><a href="architecture-visual.html" class="nav-link">System Architecture</a></li>
            </ul>
        </div>
    </nav>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Menu">
        ☰
    </button>

    <!-- Mobile Backdrop -->
    <div class="mobile-backdrop" id="mobileBackdrop" onclick="closeMobileMenu()"></div>

    <!-- Mobile Drawer -->
    <div class="mobile-drawer" id="mobileDrawer">
        <div class="mobile-drawer-header">
            <span class="mobile-drawer-title">Navigation</span>
            <button class="mobile-drawer-close" onclick="closeMobileMenu()" aria-label="Close">✕</button>
        </div>
        <ul class="mobile-nav-links">
            <li><a href="landing.html" class="mobile-nav-link">Home</a></li>
            <li><a href="app-demo.html" class="mobile-nav-link">Live Demo</a></li>
            <li><a href="zero-sequence-live.html" class="mobile-nav-link">AI Intelligence</a></li>
            <li><a href="action-modal-explorer.html" class="mobile-nav-link">Actions</a></li>
            <li><a href="intent-action-explorer.html" class="mobile-nav-link">Intents</a></li>
            <li><a href="shopping-cart.html" class="mobile-nav-link active">Shopping</a></li>
            <li><a href="architecture-visual.html" class="mobile-nav-link">System Architecture</a></li>
        </ul>
    </div>

    <div class="main-container">
        <div class="page-header">
            <div class="header-nav">
                <a href="landing.html" class="btn-home">
                    <span>Home</span>
                </a>
            </div>
            <h1 class="page-title">
                <span>Shopping Cart</span>
            </h1>
            <p class="page-subtitle">
                Intelligent shopping assistant that tracks products, monitors prices, and manages your cart across multiple emails
            </p>
        </div>

        <!-- Overview Section -->
        <div class="section">
            <h2 class="section-title">
                <span>Overview</span>
            </h2>
            <div class="section-content">
                <p>
                    The Shopping Agent is an intelligent system that transforms your email into a powerful shopping tool.
                    It automatically detects products mentioned in your emails, tracks their prices across different merchants,
                    and helps you manage a unified shopping cart across all your email accounts.
                </p>
                <p>
                    Whether you're receiving promotional emails, sharing product links with friends, or tracking items
                    you're interested in, the Shopping Agent keeps everything organized in one place. It monitors price
                    changes, alerts you when deals expire, and even provides smart recommendations based on your shopping patterns.
                </p>
            </div>
        </div>

        <!-- Demo and Guide Container -->
        <div class="demo-and-guide-container">
            <!-- Interactive Demo Section -->
            <div class="section demo-section">
                <h2 class="section-title">
                    <span>Try It Live</span>
                </h2>
                <div class="demo-controls">
                    <button class="demo-btn demo-btn-primary" onclick="addSampleProduct()">
                        Add from Email
                    </button>
                    <button class="demo-btn demo-btn-secondary" onclick="clearDemoCart()">
                        Clear Cart
                    </button>
                    <div class="cart-summary-badge">
                        <span class="cart-count">0</span> items • $<span class="cart-total">0.00</span>
                    </div>
                </div>

                <div class="email-preview" id="emailPreview" style="display: none;">
                    <div class="email-preview-header">
                        <span class="email-preview-title">Incoming Email</span>
                        <button class="email-preview-close" onclick="closeEmailPreview()">✕</button>
                    </div>
                    <div class="email-preview-content" id="emailPreviewContent"></div>
                    <button class="demo-btn demo-btn-primary" onclick="extractFromEmail()">
                        Extract Product
                    </button>
                </div>

                <div class="cart-container" id="cartContainer">
                    <div class="cart-empty" id="cartEmpty">
                        <div class="cart-empty-text">Your cart is empty</div>
                        <div class="cart-empty-subtext">Click "Add from Email" to see the magic happen!</div>
                    </div>
                </div>

                <div class="checkout-panel" id="checkoutPanel" style="display: none;">
                    <div class="checkout-summary">
                        <div class="checkout-row">
                            <span>Subtotal:</span>
                            <span>$<span id="checkoutSubtotal">0.00</span></span>
                        </div>
                        <div class="checkout-row savings">
                            <span>You Save:</span>
                            <span>$<span id="checkoutSavings">0.00</span></span>
                        </div>
                        <div class="checkout-row total">
                            <span>Total:</span>
                            <span>$<span id="checkoutTotal">0.00</span></span>
                        </div>
                    </div>
                    <div class="merchant-links" id="merchantLinks"></div>
                </div>
            </div>

            <!-- How It Works Section -->
            <div class="section">
                <h2 class="section-title">
                    <span>How It Works</span>
                </h2>
                <div class="steps-list">
                    <div class="step-item">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h3 class="step-title">Email Detection</h3>
                            <p class="step-description">
                                The system continuously monitors your emails for shopping-related content.
                                When products, prices, or promotional offers are detected, they're automatically extracted and analyzed.
                            </p>
                        </div>
                    </div>

                    <div class="step-item">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h3 class="step-title">Product Resolution</h3>
                            <p class="step-description">
                                Each detected product is enriched with additional information including current pricing,
                                availability, merchant details, and product specifications. Duplicates are identified and merged.
                            </p>
                        </div>
                    </div>

                    <div class="step-item">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h3 class="step-title">Cart Management</h3>
                            <p class="step-description">
                                Products are automatically added to your unified cart. You can review, modify quantities,
                                remove items, and organize your shopping list across all your email accounts.
                            </p>
                        </div>
                    </div>

                    <div class="step-item">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h3 class="step-title">Price Tracking (Coming Soon)</h3>
                            <p class="step-description">
                                The system tracks price information for items in your cart. Future updates will include
                                automated price monitoring and alerts when prices drop at alternative merchants.
                            </p>
                        </div>
                    </div>

                    <div class="step-item">
                        <div class="step-number">5</div>
                        <div class="step-content">
                            <h3 class="step-title">Checkout Assistance</h3>
                            <p class="step-description">
                                When you're ready to purchase, the system generates optimized checkout links for each merchant,
                                pre-filled with your cart items for a seamless buying experience.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Key Features Section -->
        <div class="section">
            <h2 class="section-title">
                <span>Key Features</span>
            </h2>
            <div class="features-grid">
                <div class="feature-card">
                    <h3 class="feature-title">Multi-Email Cart Management</h3>
                    <p class="feature-description">
                        Consolidate products from all your email accounts into a single, unified shopping cart.
                        Track items across different inboxes and never lose sight of products you're interested in.
                    </p>
                </div>

                <div class="feature-card">
                    <h3 class="feature-title">Price Tracking & Comparisons (Coming Soon)</h3>
                    <p class="feature-description">
                        Track price information and compare products across different merchants.
                        Future updates will include automated notifications when better deals become available.
                    </p>
                </div>

                <div class="feature-card">
                    <h3 class="feature-title">Expiration Monitoring</h3>
                    <p class="feature-description">
                        Track promotional offers and deal expiration dates. Receive timely alerts before
                        special prices expire so you never miss out on limited-time offers.
                    </p>
                </div>

                <div class="feature-card">
                    <h3 class="feature-title">Merchant Analysis</h3>
                    <p class="feature-description">
                        Get insights into merchant reliability, shipping times, and customer reviews.
                        Make informed decisions about where to purchase your items.
                    </p>
                </div>

                <div class="feature-card">
                    <h3 class="feature-title">Smart Product Resolution</h3>
                    <p class="feature-description">
                        Advanced AI identifies and resolves duplicate products from different sources,
                        ensuring your cart stays clean and organized with unique items only.
                    </p>
                </div>

                <div class="feature-card">
                    <h3 class="feature-title">Quick Checkout Links</h3>
                    <p class="feature-description">
                        Generate instant checkout links for your cart items. One-click access to complete
                        your purchases across multiple merchants without re-entering information.
                    </p>
                </div>

                <div class="feature-card" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.05) 100%); border-color: rgba(16, 185, 129, 0.3);">
                    <h3 class="feature-title">AI-Powered "Add to Cart & Checkout" - NEW!</h3>
                    <p class="feature-description">
                        Revolutionary AI automation that clicks "Add to Cart" buttons FOR YOU! Using Steel.dev browser automation,
                        the system navigates to product pages, finds buttons using natural language AI, adds items to cart,
                        and opens checkout - all in 10-15 seconds. Supports Amazon, Shopify, Walmart, Target, and more!
                    </p>
                </div>
            </div>
        </div>

        <!-- API Endpoints Section -->
        <div class="section">
            <h2 class="section-title">
                <span>API Endpoints</span>
            </h2>
            <div class="endpoints-list">
                <div class="endpoint-item">
                    <span class="endpoint-method post">POST</span>
                    <code class="endpoint-path">/cart/add</code>
                    <span class="endpoint-description">Add a new item to the user's shopping cart</span>
                </div>

                <div class="endpoint-item">
                    <span class="endpoint-method get">GET</span>
                    <code class="endpoint-path">/cart/:userId</code>
                    <span class="endpoint-description">Retrieve all items in a user's shopping cart</span>
                </div>

                <div class="endpoint-item">
                    <span class="endpoint-method delete">DELETE</span>
                    <code class="endpoint-path">/cart/:userId/:itemId</code>
                    <span class="endpoint-description">Remove a specific item from the cart</span>
                </div>

                <div class="endpoint-item">
                    <span class="endpoint-method patch">PATCH</span>
                    <code class="endpoint-path">/cart/:userId/:itemId</code>
                    <span class="endpoint-description">Update item details (quantity, notes, etc.)</span>
                </div>

                <div class="endpoint-item">
                    <span class="endpoint-method post">POST</span>
                    <code class="endpoint-path">/products/resolve</code>
                    <span class="endpoint-description">Resolve and enrich product information from URLs or descriptions</span>
                </div>

                <div class="endpoint-item">
                    <span class="endpoint-method post">POST</span>
                    <code class="endpoint-path">/products/compare</code>
                    <span class="endpoint-description">Compare products across multiple merchants and find best prices</span>
                </div>

                <div class="endpoint-item">
                    <span class="endpoint-method post">POST</span>
                    <code class="endpoint-path">/checkout/generate-link</code>
                    <span class="endpoint-description">Generate pre-filled checkout links for cart items</span>
                </div>

                <div class="endpoint-item" style="background: rgba(16, 185, 129, 0.08); border-color: rgba(16, 185, 129, 0.3);">
                    <span class="endpoint-method post">POST</span>
                    <code class="endpoint-path">/api/shopping/add-to-cart</code>
                    <span class="endpoint-description">NEW: AI-powered automation - automatically adds product to cart and navigates to checkout</span>
                </div>

                <div class="endpoint-item" style="background: rgba(16, 185, 129, 0.08); border-color: rgba(16, 185, 129, 0.3);">
                    <span class="endpoint-method get">GET</span>
                    <code class="endpoint-path">/api/shopping/platform-info</code>
                    <span class="endpoint-description">NEW: Get platform detection info for a product URL (diagnostic)</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Demo State
        let demoCart = [];
        let sampleProductIndex = 0; // Start with Target AirPods (VERIFIED product)

        // Sample Products from "Emails" - ROBUST FALLBACK SET
        // Product URLs verified and tested - see ROBUST_FALLBACK_SUMMARY.md
        const sampleProducts = [
            {
                id: 'prod-1',
                productName: 'AirPods Pro (2nd Generation)',
                price: 199.99,
                originalPrice: 249.99,
                merchant: 'Target',
                category: 'Audio',
                icon: '🎵',
                productUrl: 'https://www.target.com/p/airpods-pro-2nd-generation/-/A-85978622',
                verified: true,
                expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                emailPreview: `🎯 Target Deal Alert

AirPods Pro (2nd Generation)

Special Price: $199.99 (Save $50!)
Reg. Price: $249.99

✨ Features:
- Adaptive Audio
- Active Noise Cancellation
- USB-C charging
- Up to 6 hours listening time

⏰ Limited time offer!
Shop now: https://www.target.com/p/-/A-85978622`
            },
            {
                id: 'prod-2',
                productName: 'Fire TV Stick 4K',
                price: 49.99,
                originalPrice: 59.99,
                merchant: 'Amazon',
                category: 'Electronics',
                icon: '📺',
                productUrl: 'https://www.amazon.com/dp/B0BP9SNVH9',
                asin: 'B0BP9SNVH9',
                expiresAt: new Date(Date.now() + 48 * 60 * 60 * 1000).toISOString(),
                emailPreview: `📦 Amazon Prime Day Early Access

Fire TV Stick 4K

Prime Member Price: $49.99
Was: $59.99 💰 SAVE $10

✨ Features:
- 4K Ultra HD streaming
- Wi-Fi 6 support
- Alexa Voice Remote
- Free with Prime membership benefits

🎬 Stream thousands of channels!
Add to cart: https://www.amazon.com/dp/B0BP9SNVH9`
            },
            {
                id: 'prod-3',
                productName: 'Nintendo Switch OLED',
                price: 349.99,
                originalPrice: 349.99,
                merchant: 'Target',
                category: 'Gaming',
                icon: '🎮',
                productUrl: 'https://www.target.com/p/nintendo-switch-oled-model-white/-/A-83887445',
                expiresAt: new Date(Date.now() + 72 * 60 * 60 * 1000).toISOString(),
                emailPreview: `🎮 Target Gaming Weekly

Nintendo Switch OLED Model

In Stock: $349.99

✨ Features:
- 7" OLED screen
- 64 GB internal storage
- Enhanced audio
- Includes dock & Joy-Con controllers

🔥 Back in stock - limited quantities!
Buy now: https://www.target.com/p/-/A-83887445`
            },
            {
                id: 'prod-4',
                productName: 'Personalized Name Necklace',
                price: 34.99,
                originalPrice: 44.99,
                merchant: 'Etsy',
                category: 'Jewelry',
                icon: '💎',
                productUrl: 'https://www.etsy.com/listing/265284352/personalized-name-necklace-custom-name',
                expiresAt: new Date(Date.now() + 96 * 60 * 60 * 1000).toISOString(),
                emailPreview: `✨ Etsy Featured Shop - CaitlynMinimalist

Personalized Name Necklace

Sale Price: $34.99 (22% OFF!)
Original: $44.99

💝 Perfect Gift:
- Custom hand-stamped names
- 14k gold filled or sterling silver
- 4.9★ rating (127,000+ reviews)
- Ships in 1-2 business days

🎁 Most gifted item this month!
Customize yours: https://www.etsy.com/listing/265284352`
            },
            {
                id: 'prod-5',
                productName: 'Echo Dot (5th Gen)',
                price: 49.99,
                originalPrice: 49.99,
                merchant: 'Amazon',
                category: 'Smart Home',
                icon: '🔊',
                productUrl: 'https://www.amazon.com/dp/B09B8V1LZ3',
                asin: 'B09B8V1LZ3',
                expiresAt: new Date(Date.now() + 120 * 60 * 60 * 1000).toISOString(),
                emailPreview: `🔊 Amazon Devices Sale

Echo Dot (5th Generation)

Best Price: $49.99

✨ New Features:
- Bigger, better sound
- Built-in smart home hub
- Alexa voice assistant
- Clock display

🏠 Control your smart home with voice!
Order today: https://www.amazon.com/dp/B09B8V1LZ3`
            }
        ];

        // Add Sample Product from Email
        function addSampleProduct() {
            const product = sampleProducts[sampleProductIndex];
            sampleProductIndex = (sampleProductIndex + 1) % sampleProducts.length;

            // Show email preview
            showEmailPreview(product);
        }

        // Show Email Preview
        function showEmailPreview(product) {
            const emailPreview = document.getElementById('emailPreview');
            const emailContent = document.getElementById('emailPreviewContent');

            emailContent.textContent = product.emailPreview;
            emailPreview.style.display = 'block';

            // Store current product for extraction
            window.currentEmailProduct = product;
        }

        // Close Email Preview
        function closeEmailPreview() {
            const emailPreview = document.getElementById('emailPreview');
            emailPreview.style.display = 'none';
            window.currentEmailProduct = null;
        }

        // Extract Product from Email
        function extractFromEmail() {
            if (!window.currentEmailProduct) return;

            const product = window.currentEmailProduct;

            // Add to cart
            demoCart.push({
                ...product,
                quantity: 1
            });

            // Close email preview
            closeEmailPreview();

            // Update cart display
            renderCart();
            updateCartSummary();
        }

        // Render Cart
        function renderCart() {
            const cartContainer = document.getElementById('cartContainer');
            const cartEmpty = document.getElementById('cartEmpty');

            if (demoCart.length === 0) {
                cartEmpty.style.display = 'block';
                cartContainer.querySelectorAll('.cart-item').forEach(el => el.remove());
                document.getElementById('checkoutPanel').style.display = 'none';
                return;
            }

            cartEmpty.style.display = 'none';
            document.getElementById('checkoutPanel').style.display = 'block';

            // Clear existing items
            cartContainer.querySelectorAll('.cart-item').forEach(el => el.remove());

            // Render each item
            demoCart.forEach((item, index) => {
                const itemEl = createCartItemElement(item, index);
                cartContainer.appendChild(itemEl);
            });

            updateCheckoutPanel();
        }

        // Create Cart Item Element
        function createCartItemElement(item, index) {
            const div = document.createElement('div');
            div.className = 'cart-item';

            const savings = item.originalPrice ? (item.originalPrice - item.price) : 0;
            const savingsPercent = item.originalPrice ? Math.round((savings / item.originalPrice) * 100) : 0;

            const hoursUntilExpiry = item.expiresAt ?
                Math.floor((new Date(item.expiresAt) - new Date()) / (1000 * 60 * 60)) : null;
            const isUrgent = hoursUntilExpiry !== null && hoursUntilExpiry < 24;

            div.innerHTML = `
                <div class="cart-item-image">${item.icon}</div>
                <div class="cart-item-name">${item.productName}</div>
                <div class="cart-item-merchant">${item.merchant}</div>
                <div class="cart-item-price">
                    <span class="cart-item-current-price">$${item.price.toFixed(2)}</span>
                    ${item.originalPrice ? `<span class="cart-item-original-price">$${item.originalPrice.toFixed(2)}</span>` : ''}
                </div>
                ${savings > 0 ? `<div class="cart-item-savings">Save $${savings.toFixed(2)} (${savingsPercent}% off)</div>` : ''}
                ${hoursUntilExpiry !== null ? `
                    <div class="cart-item-expiry ${isUrgent ? 'urgent' : ''}">
                        ${hoursUntilExpiry}h remaining
                    </div>
                ` : ''}
                <div class="cart-item-controls">
                    <div class="quantity-control">
                        <button class="quantity-btn" onclick="updateQuantity(${index}, -1)">−</button>
                        <span class="quantity-value">${item.quantity}</span>
                        <button class="quantity-btn" onclick="updateQuantity(${index}, 1)">+</button>
                    </div>
                    <button class="remove-btn" onclick="removeItem(${index})">Remove</button>
                </div>
            `;

            return div;
        }

        // Update Quantity
        function updateQuantity(index, delta) {
            if (!demoCart[index]) return;

            const newQuantity = demoCart[index].quantity + delta;
            if (newQuantity < 1) {
                removeItem(index);
                return;
            }

            demoCart[index].quantity = newQuantity;
            renderCart();
            updateCartSummary();
        }

        // Remove Item
        function removeItem(index) {
            demoCart.splice(index, 1);
            renderCart();
            updateCartSummary();
        }

        // Clear Cart
        function clearDemoCart() {
            if (demoCart.length === 0) return;

            if (confirm('Clear all items from cart?')) {
                demoCart = [];
                renderCart();
                updateCartSummary();
            }
        }

        // Update Cart Summary Badge
        function updateCartSummary() {
            const totalItems = demoCart.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = demoCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            document.querySelector('.cart-count').textContent = totalItems;
            document.querySelector('.cart-total').textContent = totalPrice.toFixed(2);
        }

        // Update Checkout Panel
        function updateCheckoutPanel() {
            const subtotal = demoCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const originalTotal = demoCart.reduce((sum, item) => {
                const original = item.originalPrice || item.price;
                return sum + (original * item.quantity);
            }, 0);
            const savings = originalTotal - subtotal;

            document.getElementById('checkoutSubtotal').textContent = subtotal.toFixed(2);
            document.getElementById('checkoutSavings').textContent = savings.toFixed(2);
            document.getElementById('checkoutTotal').textContent = subtotal.toFixed(2);

            // Update merchant links
            const merchantGroups = {};
            demoCart.forEach(item => {
                if (!merchantGroups[item.merchant]) {
                    merchantGroups[item.merchant] = [];
                }
                merchantGroups[item.merchant].push(item);
            });

            const merchantLinksEl = document.getElementById('merchantLinks');
            merchantLinksEl.innerHTML = Object.keys(merchantGroups).length > 0 ?
                '<div class="merchant-links-title">AI Checkout by Merchant:</div>' : '';

            Object.keys(merchantGroups).forEach(merchant => {
                const items = merchantGroups[merchant];
                const merchantTotal = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);

                const linkEl = document.createElement('a');
                linkEl.className = 'merchant-link';
                linkEl.href = '#';
                linkEl.onclick = async (e) => {
                    e.preventDefault();
                    await automateCheckout(e, merchant, items);
                };
                linkEl.innerHTML = `
                    <span class="merchant-link-label">${merchant} (${items.length} item${items.length > 1 ? 's' : ''})</span>
                    <span class="merchant-link-price">$${merchantTotal.toFixed(2)} →</span>
                `;
                merchantLinksEl.appendChild(linkEl);
            });
        }

        // Automate Checkout with AI
        async function automateCheckout(event, merchant, items) {
            if (items.length === 0) return;

            // For now, process first item (multi-item checkout would require combining carts)
            const item = items[0];

            if (!item.productUrl) {
                alert(`❌ Error: No product URL found for ${item.productName}`);
                return;
            }

            // Show loading state with spinner
            const button = event.currentTarget;
            const originalText = button.innerHTML;
            button.classList.add('button-loading');
            button.innerHTML = '<span class="loading-spinner"></span><span>AI Processing...</span>';
            button.style.pointerEvents = 'none';

            try {
                console.log(`🤖 Calling shopping automation API for ${item.productName}...`);

                // Call the real API (production Steel Agent)
                const response = await fetch('https://steel-agent-514014482017.us-central1.run.app/api/shopping/add-to-cart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        productUrl: item.productUrl,
                        productName: item.productName,
                        userSessionId: 'web-demo-' + Date.now()
                    })
                });

                const result = await response.json();

                console.log('API Response:', result);

                if (result.success) {
                    // Success! Open checkout URL
                    alert(`✅ Success!\n\n🤖 AI automation completed!\n\n✓ Detected platform: ${result.steps?.[0]?.platform || merchant}\n✓ Added ${item.productName} to cart\n✓ Navigated to checkout\n\nOpening checkout page...`);
                    window.open(result.checkoutUrl, '_blank');
                } else if (result.fallbackMode) {
                    // Fallback mode - automation failed but we have product URL
                    alert(`⚠️ Automation Unavailable\n\n${result.message || 'AI automation temporarily unavailable'}\n\n✓ Platform detected: ${result.steps?.[0]?.platform || merchant}\n${result.error ? '✗ Error: ' + result.error : ''}\n\nOpening product page for manual checkout...`);
                    window.open(result.productUrl, '_blank');
                } else {
                    // Error
                    alert(`❌ Automation Failed\n\n${result.error || 'Unknown error'}\n\nPlease try again or checkout manually.`);
                }

            } catch (error) {
                console.error('Shopping automation error:', error);
                alert(`❌ API Error\n\n${error.message}\n\nMake sure the Steel Agent service is running on port 8087.`);
            } finally {
                // Restore button state
                button.classList.remove('button-loading');
                button.innerHTML = originalText;
                button.style.pointerEvents = 'auto';
            }
        }

        // Proceed to Checkout (Fallback)
        function proceedToCheckout() {
            if (demoCart.length === 0) return;

            alert(`🎉 Checkout Demo!\n\nClick the merchant-specific "🤖 AI Checkout" buttons below to trigger the real AI automation!\n\nCart contains:\n${demoCart.map(item =>
                `• ${item.productName} (${item.quantity}x) - $${(item.price * item.quantity).toFixed(2)}`
            ).join('\n')}\n\nTotal: $${demoCart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2)}`);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderCart();
            updateCartSummary();
        });

        // Mobile Menu Functions
        function toggleMobileMenu() {
            const drawer = document.getElementById('mobileDrawer');
            const backdrop = document.getElementById('mobileBackdrop');
            drawer.classList.toggle('open');
            backdrop.classList.toggle('visible');
        }

        function closeMobileMenu() {
            const drawer = document.getElementById('mobileDrawer');
            const backdrop = document.getElementById('mobileBackdrop');
            drawer.classList.remove('open');
            backdrop.classList.remove('visible');
        }

        // Close mobile menu on link click
        document.querySelectorAll('.mobile-nav-link').forEach(link => {
            link.addEventListener('click', () => {
                setTimeout(closeMobileMenu, 300);
            });
        });
    </script>
</body>
</html>
